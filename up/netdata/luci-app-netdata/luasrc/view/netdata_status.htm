<%
	local fs = require "nixio.fs"
	local nutil = require "nixio.util"
	local uci = require 'luci.model.uci'.cursor()
	local running = luci.sys.exec("busybox ps -w | grep netdata | grep -v grep  >/dev/null && echo -ne '1' ")
	local ssl =  uci:get_first('netdata', 'netdata', 'enable_ssl') 
	local nginx =  uci:get_first('netdata', 'netdata', 'nginx_support')
	local endurl = ''
	local srcssl = 'http:'
	if  ssl == '1'  then 
	     srcssl = 'https:'
	end
	endurl = ':' .. uci:get_first('netdata', 'netdata', 'port')
	if  nginx == '1'  then
	    endurl =  '/netdata/' 
    end
-%>
<script type="text/javascript">//<![CDATA[
	XHR.poll(3, '<%=url([[admin]], [[status]], [[netdata_status]])%>', null,
		function(x, d) {
			var tb = document.getElementById('netdata_status');
			if (d && tb)
			{
				if (d.running)
				{
				
					URL = <%=srcssl%> + window.location.hostname + <%=endurl%> ;
					tb.innerHTML = '<em style=\"color:green\"><%:The Netdata service is running.%></em>';
					tb.innerHTML +='<em> <br/><br/><%:Click the new page to open Netdata%> </em>';
					tb.innerHTML += "<input class=\"cbi-button cbi-button-reload \" type=\"button\" value=\" "+ URL + "\" onclick=\"window.open('"+URL+"')\"/>";
				}
				else
				{
					tb.innerHTML = '<em style=\"color:red\"><%:The Netdata service is not running.%></em>';
				}
			}
		}
	);
//]]></script>
<style>.mar-10 {margin-left: 50px; margin-right: 10px;}</style>
<fieldset class="cbi-section">
	<legend><%:NetData Status%></legend>
	<p id="netdata_status">
		<em><%:Collecting data...%></em>
	</p>
</fieldset>